package main

import (
	"net/http"

	"github.com/gorilla/sessions"
)

type Context struct {
	Sess      *sessions.Session
	UserId    int
	Username  string
	Password  string
	FirstName string
	LastName  string
}

func getContext(r *http.Request) (*Context, error) {
	sess, _ := store.Get(r, "gotalk")
	userId, ok := sess.Values["user"].(int)
	if !ok {
		return &Context{Sess: sess, UserId: -1}, nil
	}
	var username, password, firstName, lastName string
	sql := "SELECT username, password, first_name, last_name FROM users WHERE user_id = $1"
	err := db.QueryRow(sql, userId).Scan(&username, &password, &firstName, &lastName)
	if err != nil {
		return nil, err
	}
	return &Context{sess, userId, username, password, firstName, lastName}, nil
}
